<% puts "ðŸŸ§ FORM RENDERED - ERRORS: #{price_record.errors.full_messages}" %>
<% Rails.logger.debug "ðŸŸ§ FORM RENDERED - ERRORS: #{price_record.errors.full_messages}" %>

<!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
<%= render "shared/error_message", resource: @price_record %>
<%= form_with model: @price_record,
              url: url,
              data: { controller: "price-record-autocomplete" },
              local: false,
              class: "space-y-6" do |f| %>

  <!-- å•†å“å -->
  <div data-price-record-autocomplete-target="wrapper" class="relative">

    <%= f.label :product_name, "å•†å“å",
          class: "block text-sm font-semibold text-gray-700 mb-1" %>

    <!-- æ—¢å­˜å•†å“ã® IDï¼ˆStimulus ãŒåˆ‡ã‚Šæ›¿ãˆã‚‹ï¼‰ -->
    <%= f.hidden_field :product_id, value: @price_record.product_id %>

    <!-- å…¥åŠ›æ¬„ -->
    <%= f.text_field :product_name,
      value: @product_name || params.dig(:price_record, :product_name),
      placeholder: "ä¾‹ï¼šç‰›ä¹³",
      autocomplete: "off",
      data: {
        action: "input->price-record-autocomplete#search",
        price_record_autocomplete_target: "input"
      },
      class: "w-full border border-gray-300 rounded-xl p-3 focus:ring-2 
              focus:ring-orange-400 focus:border-orange-400 outline-none shadow-sm" %>

    <!-- ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆçµæžœ -->
    <div data-price-record-autocomplete-target="results"
         class="absolute left-0 right-0 z-[9999] mt-1 bg-white 
                border border-orange-200 rounded-xl shadow-xl hidden"></div>
  </div>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆæ–°è¦å•†å“ã®ã¨ãã ã‘ Stimulus ãŒè¡¨ç¤ºï¼‰ -->
  <div data-price-record-autocomplete-target="categoryWrapper" class="hidden">
    <%= f.label :category_id, "ã‚«ãƒ†ã‚´ãƒªãƒ¼",
          class: "block text-sm font-semibold text-gray-700 mb-1" %>

    <%= f.collection_select :category_id, @categories, :id, :name,
          { prompt: "é¸æŠžã—ã¦ãã ã•ã„",
            selected: @category_id || params.dig(:price_record, :category_id) },
          class: "w-full border border-gray-300 rounded-xl p-3 bg-white
                  focus:ring-2 focus:ring-orange-400 outline-none shadow-sm" %>
  </div>

  <!-- åº—èˆ— -->
  <div>
    <%= f.label :shop_id, "åº—å", class: "block text-sm font-semibold text-gray-700 mb-1" %>
    <%= f.collection_select :shop_id, @shops, :id, :name,
        { prompt: "é¸æŠžã—ã¦ãã ã•ã„" },
        class: "w-full border border-gray-300 rounded-xl p-3 bg-white
                focus:ring-2 focus:ring-orange-400 outline-none shadow-sm" %>
  </div>

  <!-- ä¾¡æ ¼ -->
  <div>
    <%= f.label :price, "ä¾¡æ ¼", class: "block text-sm font-semibold text-gray-700 mb-1" %>
    <%= f.number_field :price, step: 1, placeholder: "ä¾‹ï¼š198",
        class: "w-full border border-gray-300 rounded-xl p-3
                focus:ring-2 focus:ring-orange-400 outline-none shadow-sm" %>
  </div>

  <!-- æ—¥ä»˜ -->
  <div>
    <%= f.label :purchased_at, "æ—¥ä»˜", class: "block text-sm font-semibold text-gray-700 mb-1" %>
    <%= f.date_field :purchased_at,
        value: @price_record.purchased_at || Date.today,
        class: "w-full border border-gray-300 rounded-xl p-3
                focus:ring-2 focus:ring-orange-400 outline-none shadow-sm" %>
  </div>

  <!-- ãƒ¡ãƒ¢ -->
  <div>
    <%= f.label :memo, "ãƒ¡ãƒ¢", class: "block text-sm font-semibold text-gray-700 mb-1" %>
    <%= f.text_area :memo, rows: 3, placeholder: "ä¾‹ï¼šåºƒå‘Šã®å“ã€ã¾ã¨ã‚è²·ã„ãªã©",
        class: "w-full border border-gray-300 rounded-xl p-3
                focus:ring-2 focus:ring-orange-400 outline-none shadow-sm" %>
  </div>

  <!-- ç™»éŒ²ãƒœã‚¿ãƒ³ -->
  <div>
    <%= f.submit "ç™»éŒ²ã™ã‚‹",
        class: "w-full bg-orange-500 hover:bg-orange-600 text-white font-bold 
                py-3 rounded-xl shadow-md transition active:scale-[0.98]" %>
  </div>

<% end %>
