<div class="min-h-screen bg-base text-gray-800 py-10 px-4 flex justify-center sm:px-6 md:px-10">
  <div class="w-full max-w-md sm:max-w-lg md:max-w-xl bg-white rounded-2xl shadow-card p-8 md:p-10 md:p-12 border border-orange-100">
    <h2 class="text-2xl md:text-3xl font-bold text-center text-brand mb-8">プロフィールを編集</h2>

    <%= form_with model: @user, url: profile_path, local: true, html: { data: { controller: "avatar-preview" } } do |f| %>
      <div class="space-y-6">

        <!-- ニックネーム -->
        <div>
          <%= f.label :nickname, "ニックネーム", class: "block text-gray-700 font-medium mb-2" %>
          <%= f.text_field :nickname,
                class: "w-full border border-gray-300 rounded-lg px-4 py-2 md:py-3 focus:outline-none focus:ring-2 focus:ring-brand transition",
                placeholder: "例：おかいも太郎" %>
        </div>

        <!-- 都道府県エリア -->
        <div>
          <%= f.label :prefecture, "お住まいの都道府県(任意)", class: "block text-gray-700 font-medium mb-2" %>
          <%= f.select :prefecture,
                PREFECTURES,
                { include_blank: "選択してください" },
                class: "w-full border border-gray-300 rounded-lg px-4 py-2 md:py-3 focus:outline-none focus:ring-2 focus:ring-brand transition bg-white" %>
        </div>

        <!-- プロフィール画像 -->
        <div>
          <%= f.label :avatar, "プロフィール画像", class: "block text-gray-700 font-medium mb-3" %>
          <%= f.file_field :avatar,
                data: { avatar_preview_target: "input", action: "change->avatar-preview#preview" },
                class: "w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-brand transition" %>

          <!-- 比較表示ブロック -->
          <div class="mt-6 flex flex-col sm:flex-row justify-center items-center gap-6">
            <!-- 現在の画像 -->
            <div class="text-center">
              <p class="text-sm text-gray-600 mb-2">現在</p>
              <% if @user.avatar.attached? %>
                <%= image_tag @user.avatar.variant(resize_to_fill: [100, 100]),
                      class: "w-28 h-28 rounded-full object-cover shadow-sm border border-gray-200" %>
              <% else %>
                <div class="w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                  <i class="fas fa-user fa-lg"></i>
                </div>
              <% end %>
            </div>

            <!-- 矢印 -->
            <div class="text-gray-400 text-2xl hidden sm:block">
              <i class="fas fa-arrow-right"></i>
            </div>
            <div class="text-gray-400 text-2xl sm:hidden">
              <i class="fas fa-arrow-down"></i>
            </div>

            <!-- 新しい画像プレビュー -->
            <div class="text-center">
              <p class="text-sm text-gray-600 mb-2">新しい画像</p>
              <img data-avatar-preview-target="preview"
                   class="hidden w-28 h-28 rounded-full object-cover shadow-sm border border-gray-200 opacity-0 transition-opacity duration-300"
                   alt="新しいプロフィール画像プレビュー">
            </div>
          </div>
        </div>

        <!-- 更新ボタン -->
        <div class="text-center pt-4">
          <%= f.submit "更新する",
                class: "w-full sm:w-auto bg-brand text-white font-semibold px-8 py-2.5 md:py-3 rounded-full shadow hover:bg-orange-600 transition duration-200" %>
        </div>
      </div>
    <% end %>

    <div class="text-center mt-8">
      <%= link_to '戻る', profile_path,
            class: "inline-block bg-gray-200 text-gray-700 px-6 sm:px-8 py-2.5 rounded-full shadow hover:bg-gray-300 transition duration-200" %>
    </div>
  </div>
</div>