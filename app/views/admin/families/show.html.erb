<% content_for :title, "ファミリー詳細" %>

<section class="space-y-8">
  <div>
    <%= link_to admin_families_path,
        class: "inline-flex items-center gap-2 px-3 py-1.5 bg-orange-100
                text-orange-700 rounded-lg text-sm font-semibold
                hover:bg-orange-200 transition" do %>
      <i class="fa-solid fa-arrow-left"></i>
      一覧に戻る
    <% end %>
  </div>

  <!-- タイトルカード -->
  <div class="bg-white rounded-2xl shadow-md border border-orange-100 p-6 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-gray-800"><%= @family.name %></h1>
      <p class="text-gray-500 text-sm mt-1">
        メンバー数：<%= @members.count %>
      </p>
    </div>
  </div>

  <!-- メンバー一覧 -->
  <div class="bg-white rounded-2xl shadow-md border border-orange-100 p-6">
    <h2 class="text-lg font-bold text-gray-800 mb-4">メンバー一覧</h2>

    <table class="w-full text-sm">
      <thead class="bg-orange-50 text-gray-700 text-xs uppercase tracking-wide">
        <tr>
          <th class="px-4 py-3 border-b">名前</th>
          <th class="px-4 py-3 border-b">メール</th>
          <th class="px-4 py-3 border-b">役割</th>
          <th class="px-4 py-3 border-b">登録日</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-orange-50">
        <% @members.each do |user| %>
          <tr>
            <td class="px-4 py-3 font-medium"><%= user.nickname %></td>
            <td class="px-4 py-3"><%= user.email %></td>

            <!-- 役割 + 管理者変更ボタン -->
            <td class="px-4 py-3 flex items-center gap-3">
              <!-- 現在の役割表示 -->
              <span class="px-2 py-1 rounded-lg text-xs
                <%= user.family_admin? ? 'bg-red-100 text-red-600' : 'bg-gray-100 text-gray-600' %>">
                <%= user.family_admin? ? "管理者" : "メンバー" %>
              </span>

              <!-- 管理者でない場合のみ「管理者に変更」ボタンを表示 -->
              <% unless user.family_admin? %>
                <%= button_to "管理者に変更",
                      change_admin_admin_family_path(@family, user_id: user.id),
                      method: :patch,
                      data: {
                      turbo_confirm: "本当にこのユーザーを管理者に変更しますか？\n現在の管理者はメンバーに降格します。"
                      },
                      class: "px-2 py-1 bg-orange-500 hover:bg-orange-600
                              text-white text-xs rounded-lg font-semibold" %>
                <% end %>
              </td>
            <td class="px-4 py-3"><%= user.created_at.strftime("%Y-%m-%d") %></td>

            <!-- 退出ボタン -->
            <td class="px-4 py-3 text-right">
              <% unless user.family_admin? %> <!-- 管理者は削除不可 -->
                <%= button_to "退出させる",
                      remove_member_admin_family_path(@family, user_id: user.id),
                      method: :delete,
                      data: {
                        turbo_confirm: "このユーザーを家族から外しますか？\nデータは消えませんが、共有機能は使えなくなります。"
                      },
                      class: "px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded-lg font-semibold" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>
