<h1 class="text-xl font-bold mb-4">買い物リスト<h1>

<%= render "shared/error_message", resource: @shopping_list %>

<!-- 商品追加フォーム  -->
<%= form_with model: [@shopping_list, @shopping_items], local: true do |f| %>
  <div class= "flex gap-2 mb-4">
    <%= f.text_field :name, placeholder: "商品名を入力", class: "flex-1 border rounded p-2" %>
    <%= f.text_area :memo,rows: 3, placeholder: "メモ", class: "flex-1 border rounded p-2" %>
    <%= f.submit "追加", class: "bg-orange-500 text-white px-4 py-2 rounded" %>
  </div>
<% end %>

<!-- 未購入品一覧 -->
<h2 class="text-lg font-semibold mb-2">買うもの</h2>
<ul class="divide-y divide-gray-200 mb-6">
  <% @shopping_items.where(purchased: false).each do |item| %>
    <li class="flex item-center justify-between p-3">
      <div class="flex items-center gap-3">
        <!-- アイコンの切り替え -->
        <%= button_to shopping_list_shopping_item_path(item), method: :patch, form: { data: { turbo_stream: true } }, class: "text-gray-400 hover:text-orange-500" do %>
          <i class="fa-bold fa-shopping-cart"></i>
        <% end %>
        <span><%= item.name %></span>
      </div>
      <!-- ゴミ箱アイコン -->
      <%= button_to shopping_list_shopping_item_path(item), method: :delete, data: { confirm: "削除しますか？" }, class: "text-red-500 hover:text-red-700" do %>
        <i class="fa-bold fa-trash"></i>
      <% end %>
    </li>
  <% end %>
</ul>

<!-- 購入済み -->
<% purchased_items = @shopping_items.where(purchased: true) %>
<% if purchased_items/any? %>
  <h2 class="text-lg font-semibold mb-2">購入済み</h2>
  <ul class="divide-y divide-gray-200">
    <% purchased_items.each do |item| %>
      <li class="flex items-center justify-between p-3 opacity-60">
        <div class="flex items-center gap-3">
          <!-- 非同期 -->
          <%= button_to shopping_list_shopping_item_path(item), method: :patch, form: { data: { turbo_stream: true } }, class: "text-orange-400 hover:text-gray-500" do %>
            <i class="fa-bold fa-undo"></i>
          <% end %>
          <span class="line-through"><%= item.name %></span>
        </div>
        <%= button_to shopping_list_shopping_item_path(item), method: :delete, data: { confirm: "削除しますか？" }, class: "text-red-500 hover:text-red-700" do %>
          <i class="fa-bold fa-trash"></i>
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>