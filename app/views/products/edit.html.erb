<div class="min-h-screen bg-base text-gray-800 flex flex-col items-center py-10 px-4 sm:px-6 md:px-10">
  <div class="w-full max-w-md sm:max-w-lg md:max-w-xl bg-white rounded-2xl shadow-card p-6 sm:p-8 border border-orange-100">
    <!-- 戻るボタン -->
    <%= link_to category_path(@product.category), class: "inline-flex items-center text-gray-600 hover:text-orange-500 mb-4 transition-colors duration-200" do %>
      <i class="fa-solid fa-arrow-left mr-2"></i>
      一覧に戻る
    <% end %>

    <!-- 見出し -->
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6 text-center tracking-tight">商品を編集</h1>

    <!-- エラーメッセージ -->
    <%= render "shared/error_message", resource: @product %>

    <!-- 編集フォーム -->
    <%= form_with model: @product, local: true, class: "space-y-5" do |f| %>
      <!-- 商品名 -->
      <div>
        <%= f.label :name, "商品名", class: "block text-sm font-semibold text-gray-700 mb-1" %>
        <%= f.text_field :name,
              placeholder: "例：牛乳",
              class: "w-full rounded-xl border border-gray-300 focus:ring-2 focus:ring-orange-400 focus:border-orange-400 px-3 py-2 outline-none transition placeholder-gray-400 text-sm md:text-base" %>
      </div>

      <!-- カテゴリー選択 -->
      <div>
        <%= f.label :category_id, "カテゴリー選択", class: "block text-sm font-semibold text-gray-700 mb-1" %>
        <%= f.select :category_id,
              options_from_collection_for_select(@categories, :id, :name, @product.category_id),
              { include_blank: "選択してください" },
              class: "w-full rounded-xl border border-gray-300 focus:ring-2 focus:ring-orange-400 focus:border-orange-400 px-3 py-2 bg-white outline-none transition text-sm md:text-base" %>
      </div>

      <!-- メモ -->
      <div>
        <%= f.label :memo, "メモ", class: "block text-sm text-base font-semibold text-gray-700 mb-1" %>
        <%= f.text_area :memo,
              rows: 3,
              placeholder: "備考などを記入",
              class: "w-full rounded-xl border border-gray-300 focus:ring-2 focus:ring-orange-400 focus:border-orange-400 px-3 py-2 outline-none transition placeholder-gray-400 text-sm md:text-base" %>
      </div>

      <!-- 商品画像　-->
      <div>
        <%= f.label :image, "商品画像", class:"block text-sm md:text-base font-semibold text-gray-700 mb-1" %>
        <% if @product.image.attached? %>
          <!-- 画像プレビュー -->
          <div class="flex items-center gap-3 mb-3">
            <%= image_tag @product.image,
                  class: "w-20 h-20 md:w-24 md:h-24 rounded-full object-cover border border-orange-200 shadow-sm" %>
            <div class="flex items-center gap-2">
              <%= f.check_box :remove_image, class: "rounded" %>
              <label class="text-sm md:text-base text-gray-700">画像を削除する</label>
            </div>
          </div>
        <% end %>

        <!-- 画像アップロード欄 -->
        <%= f.file_field :image,
              accept: "image/*",
              class: "block w-full text-sm text-gray-700
                      file:mr-3 file:py-1 file:px-3
                      file:rounded-lg file:border file:border-orange-300
                      file:bg-orange-50 file:text-orange-600
                      hover:file:bg-orange-100 cursor-pointer" %>
        <p class="text-xs md:text-sm text-gray-400 mt-1">
          (任意) 画像の登録・変更ができます
        </p>
      </div>

      <!-- 更新ボタン -->
      <div class="pt-3">
        <%= f.submit "更新する",
              class: "w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2.5 rounded-xl shadow-md transition-transform active:scale-[0.98] text-sm md:text-base" %>
      </div>
    <% end %>

    <!-- Stimulus confirm対応 削除ボタン -->
    <div data-controller="confirm" class="mt-6 text-center relative">
      <%= button_to "削除する",
            product_path(@product),
            method: :delete,
            data: {
              action: "click->confirm#confirm",
              confirm_message: "この商品を削除しますか？"
            },
            class: "w-full text-red-600 border border-red-400 hover:bg-red-50 font-semibold py-2.5 rounded-xl shadow-sm transition" %>

      <!-- 共通確認モーダル -->
      <div data-confirm-target="modal"
           class="hidden fixed inset-0 bg-black/40 flex justify-center items-center z-50">
        <div class="bg-white rounded-2xl p-6 shadow-xl w-80 text-center border border-orange-100">
          <p data-confirm-target="message" class="text-gray-700 mb-4">
            この商品を削除しますか？
          </p>

          <div class="flex justify-center gap-4">
            <button data-action="click->confirm#proceed"
                    class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 shadow">
               削除
            </button>
            <button data-action="click->confirm#cancel"
                    class="bg-gray-200 text-gray-700 px-4 py-2 rounded-xl hover:bg-gray-300">
              キャンセル
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>